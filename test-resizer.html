<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ‹–æ‹½è¯Šæ–­</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-result {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .test-result.pass { border-left-color: #52c41a; }
        .test-result.fail { border-left-color: #ff4d4f; }
        .test-result.warn { border-left-color: #faad14; }
        .code {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 8px;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #40a9ff; }
    </style>
</head>
<body>
    <h1>ğŸ” åˆ†éš”æ¡æ‹–æ‹½åŠŸèƒ½è¯Šæ–­</h1>
    <p>è¯·åœ¨æ™ºèƒ½åˆåŒå®¡æŸ¥ç³»ç»Ÿé¡µé¢ä¸­æ‰“å¼€æ­¤è¯Šæ–­å·¥å…·</p>

    <button onclick="runTests()">ğŸš€ è¿è¡Œè¯Šæ–­æµ‹è¯•</button>
    <button onclick="testResizerDirectly()">ğŸ–±ï¸ ç›´æ¥æµ‹è¯•åˆ†éš”æ¡</button>

    <div id="results"></div>

    <script>
        function addResult(type, title, details) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong>${details ? `<div class="code">${details}</div>` : ''}`;
            results.appendChild(div);
        }

        function runTests() {
            document.getElementById('results').innerHTML = '';

            // è·å–ä¸»çª—å£
            const mainDoc = window.opener ? window.opener.document : (window.parent !== window ? window.parent.document : null);

            if (!mainDoc) {
                addResult('warn', 'âš ï¸ æ— æ³•è®¿é—®ä¸»é¡µé¢', 'è¯·ç¡®ä¿æ­¤é¡µé¢ä¸ä¸»é¡µé¢åœ¨åŒä¸€ä¸ªçª—å£ä¸­æ‰“å¼€');
                addResult('info', 'ğŸ’¡ æç¤º', 'è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°ç›´æ¥è¿è¡Œä»¥ä¸‹ä»£ç è¿›è¡Œè¯Šæ–­ï¼š');
                return;
            }

            // æµ‹è¯•1: æ£€æŸ¥ resizer å…ƒç´ 
            const resizer = mainDoc.getElementById('resizer');
            if (resizer) {
                const styles = window.getComputedStyle ? (mainDoc.defaultView ? mainDoc.defaultView.getComputedStyle(resizer) : {}) : {};
                addResult('pass', 'âœ… resizer å…ƒç´ å­˜åœ¨',
                    `ID: ${resizer.id}\nClass: ${resizer.className}\nDisplay: ${styles.display}\nPosition: ${styles.position}\nZ-Index: ${styles.zIndex}`);
            } else {
                addResult('fail', 'âŒ resizer å…ƒç´ ä¸å­˜åœ¨', 'æ— æ³•æ‰¾åˆ° id="resizer" çš„å…ƒç´ ');
            }

            // æµ‹è¯•2: æ£€æŸ¥ preview-panel
            const previewPanel = mainDoc.getElementById('preview-panel');
            if (previewPanel) {
                addResult('pass', 'âœ… preview-panel å…ƒç´ å­˜åœ¨',
                    `Width: ${previewPanel.style.width || previewPanel.offsetWidth}px\nClass: ${previewPanel.className}`);
            } else {
                addResult('fail', 'âŒ preview-panel å…ƒç´ ä¸å­˜åœ¨', 'æ— æ³•æ‰¾åˆ° id="preview-panel" çš„å…ƒç´ ');
            }

            // æµ‹è¯•3: æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
            if (resizer) {
                const hasClickListener = resizer.onclick !== null;
                addResult(hasClickListener ? 'pass' : 'warn',
                    hasClickListener ? 'âœ… resizer æœ‰ç‚¹å‡»äº‹ä»¶' : 'âš ï¸ resizer å¯èƒ½æ²¡æœ‰ mousedown äº‹ä»¶',
                    'è¯·åœ¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç æ£€æŸ¥ï¼šgetEventListeners(document.getElementById("resizer"))');
            }

            // æµ‹è¯•4: æ£€æŸ¥ CSS
            const testResizer = document.createElement('div');
            testResizer.className = 'resizer';
            addResult('pass', 'âœ… CSS ç±»å®šä¹‰', '.resizer æ ·å¼å·²å®šä¹‰');
        }

        function testResizerDirectly() {
            const mainDoc = window.opener ? window.opener.document : (window.parent !== window ? window.parent.document : document);
            const resizer = mainDoc.getElementById('resizer');

            if (!resizer) {
                alert('æ‰¾ä¸åˆ° resizer å…ƒç´ ï¼\n\nè¯·åœ¨ä¸»é¡µé¢ä¸­æ‰“å¼€æ§åˆ¶å°ï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹ä»£ç è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•ï¼š\n\n' +
                    '// æ£€æŸ¥å…ƒç´ \n' +
                    'console.log("resizer:", document.getElementById("resizer"));\n' +
                    'console.log("previewPanel:", document.getElementById("preview-panel"));\n\n' +
                    '// æ£€æŸ¥æ ·å¼\n' +
                    'const r = document.getElementById("resizer");\n' +
                    'if (r) {\n' +
                    '    const s = getComputedStyle(r);\n' +
                    '    console.log("display:", s.display);\n' +
                    '    console.log("cursor:", s.cursor);\n' +
                    '    console.log("pointerEvents:", s.pointerEvents);\n' +
                    '}');
                return;
            }

            // å°è¯•æ‰‹åŠ¨è§¦å‘äº‹ä»¶
            const event = new MouseEvent('mousedown', {
                bubbles: true,
                cancelable: true,
                button: 0,
                clientX: 500,
                clientY: 300
            });

            const dispatched = resizer.dispatchEvent(event);
            addResult(dispatched ? 'pass' : 'fail',
                dispatched ? 'âœ… äº‹ä»¶è§¦å‘æˆåŠŸ' : 'âŒ äº‹ä»¶è§¦å‘å¤±è´¥',
                'å°è¯•è§¦å‘ mousedown äº‹ä»¶');
        }

        // é¡µé¢åŠ è½½æ—¶æä¾›æ§åˆ¶å°ä»£ç 
        window.onload = function() {
            addResult('info', 'ğŸ“‹ æµè§ˆå™¨æ§åˆ¶å°è¯Šæ–­ä»£ç ', `
// å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°ä¸»é¡µé¢æ§åˆ¶å°ï¼š

// 1. æ£€æŸ¥å…ƒç´ 
console.log('resizer:', document.getElementById('resizer'));
console.log('previewPanel:', document.getElementById('preview-panel'));
console.log('editorPanel:', document.getElementById('editor-panel'));

// 2. æ£€æŸ¥æ ·å¼
const r = document.getElementById('resizer');
if (r) {
    const s = getComputedStyle(r);
    console.log('display:', s.display);
    console.log('cursor:', s.cursor);
    console.log('pointerEvents:', s.pointerEvents);
    console.log('zIndex:', s.zIndex);
    console.log('position:', s.position);
}

// 3. æµ‹è¯•ç‚¹å‡»
if (r) {
    r.addEventListener('click', () => console.log('resizer clicked!'));
    console.log('å·²æ·»åŠ ç‚¹å‡»æµ‹è¯•ï¼Œè¯·ç‚¹å‡»åˆ†éš”æ¡');
}

// 4. é‡æ–°åˆå§‹åŒ–
if (typeof initResizer === 'function') {
    console.log('initResizer å‡½æ•°å­˜åœ¨');
    initResizer();
} else {
    console.log('initResizer å‡½æ•°ä¸å­˜åœ¨ï¼Œéœ€è¦é‡æ–°åŠ è½½é¡µé¢');
}
            `);
        };
    </script>
</body>
</html>
